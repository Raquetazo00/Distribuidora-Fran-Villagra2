#:import dp kivy.metrics.dp

<FacturaScreen>:

    canvas.before:
        Color:
            rgba: 0.96, 0.96, 0.98, 1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"
        spacing: dp(20)
        padding: dp(25)

        # =====================================================
        #   BOTÓN VOLVER (arriba a la derecha)
        # =====================================================
        BoxLayout:
            size_hint_y: None
            height: dp(40)

            Widget:

            Button:
                text: "< Volver"
                size_hint: None, None
                size: dp(120), dp(35)
                background_color: 0.1, 0.2, 0.35, 1
                color: 1,1,1,1
                on_release: root.volver_menu()

        # =====================================================
        # TÍTULO
        # =====================================================
        Label:
            text: "Facturación"
            font_size: dp(34)
            bold: True
            color: 0.15, 0.15, 0.15, 1
            size_hint_y: None
            height: dp(50)

        # =====================================================
        # TIPO DE FACTURA
        # =====================================================
        BoxLayout:
            size_hint_y: None
            height: dp(60)
            spacing: dp(10)

            Label:
                text: "Tipo de Factura:"
                bold: True
                font_size: dp(18)
                size_hint_x: 0.25
                color: 0.15, 0.15, 0.15, 1

            Spinner:
                id: tipo_factura
                text: "Factura A"
                values: ["Factura A", "Factura B"]
                size_hint_x: 0.35
                font_size: dp(17)

            Widget:

        # =====================================================
        # SECCIÓN DATOS DEL CLIENTE
        # =====================================================
        Label:
            text: "Datos del Cliente"
            font_size: dp(22)
            bold: True
            size_hint_y: None
            height: dp(40)
            color: 0.12, 0.12, 0.12, 1

        # --- BOTONES DE CLIENTES ---
        BoxLayout:
            size_hint_y: None
            height: dp(45)
            spacing: dp(10)

            Button:
                text: "Clientes"
                size_hint_x: None
                width: dp(120)
                background_color: 0.1, 0.3, 0.6, 1
                color: 1,1,1,1
                font_size: dp(16)
                on_release: root.abrir_gestion_clientes()

            Button:
                text: "Seleccionar Cliente"
                size_hint_x: None
                width: dp(170)
                background_color: 0.2, 0.6, 0.9, 1
                color: 1,1,1,1
                font_size: dp(16)
                on_release: root.abrir_selector_cliente()

            Widget:

        GridLayout:
            cols: 4
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            TextInput:
                id: cliente_nombre
                hint_text: "Nombre"

            TextInput:
                id: cliente_telefono
                hint_text: "Teléfono"

            TextInput:
                id: cliente_email
                hint_text: "Email"

        TextInput:
            id: cliente_ci
            hint_text: "C.I. / RUT"
            size_hint_y: None
            height: dp(45)

        # =====================================================
        # DOS COLUMNAS PRINCIPALES (Productos + Carrito)
        # =====================================================
        BoxLayout:
            orientation: "horizontal"
            spacing: dp(25)
            size_hint_y: 1

            # ----------------------------
            #      IZQUIERDA – PRODUCTOS
            # ----------------------------
            BoxLayout:
                orientation: "vertical"
                spacing: dp(15)

                Label:
                    text: "Agregar productos"
                    bold: True
                    font_size: dp(20)
                    size_hint_y: None
                    height: dp(35)
                    color: 0.12, 0.12, 0.12, 1

                TextInput:
                    id: buscar_producto
                    hint_text: "Buscar producto..."
                    size_hint_y: None
                    height: dp(45)
                    multiline: False
                    on_text: root.buscar_producto_factura(self.text)

                ScrollView:
                    size_hint_y: 0.4
                    bar_width: dp(8)

                    BoxLayout:
                        id: resultados_busqueda
                        orientation: "vertical"
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(6)

                BoxLayout:
                    size_hint_y: None
                    height: dp(45)
                    spacing: dp(10)

                    TextInput:
                        id: cantidad_producto
                        hint_text: "1"
                        input_filter: "int"
                        size_hint_x: .3

                    Button:
                        text: "Agregar"
                        size_hint_x: .7
                        font_size: dp(17)
                        background_color: 0.15, 0.45, 0.7, 1
                        color: 1,1,1,1
                        on_release: root._agregar_wrapper()

            # ----------------------------
            #     DERECHA – CARRITO
            # ----------------------------
            BoxLayout:
                orientation: "vertical"
                spacing: dp(15)

                Label:
                    text: "Carrito de Compras"
                    bold: True
                    font_size: dp(20)
                    size_hint_y: None
                    height: dp(35)
                    color: 0.12, 0.12, 0.12, 1

                ScrollView:
                    size_hint_y: 1
                    bar_width: dp(8)

                    GridLayout:
                        id: carrito_grid
                        cols: 5
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height

                Label:
                    text: "Total: $" + str(root.total_carrito)
                    font_size: dp(22)
                    bold: True
                    size_hint_y: None
                    height: dp(45)
                    color: 0.1, 0.1, 0.1, 1

                BoxLayout:
                    size_hint_y: None
                    height: dp(50)
                    spacing: dp(12)

                    Button:
                        text: "Vaciar Carrito"
                        font_size: dp(17)
                        background_color: 0.7, 0.2, 0.2, 1
                        color: 1,1,1,1
                        on_release: root.limpiar_carrito()

                    Button:
                        text: "Generar Factura"
                        font_size: dp(17)
                        background_color: 0.15, 0.6, 0.25, 1
                        color: 1,1,1,1
                        on_release: root._generar_wrapper()
