#:import dp kivy.metrics.dp

<DetalleVentaScreen>:
    orientation: "vertical"
    padding: dp(30)
    spacing: dp(20)

    ScrollView:
        do_scroll_x: False
        do_scroll_y: True

        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: self.minimum_height
            spacing: dp(20)

            # ==================================================
            # ENCABEZADO GENERAL
            # ==================================================
            Label:
                text: "Distribuidora Fran Villagra"
                font_size: dp(32)
                bold: True
                halign: "center"
                size_hint_y: None
                height: dp(50)
                color: 0, 0, 0, 1

            Label:
                text: "CUIT 30-12345678-9\nAv. Principal 123 - Tel: 3815000000"
                font_size: dp(18)
                halign: "center"
                size_hint_y: None
                height: dp(60)
                color: 0.2, 0.2, 0.2, 1

            Label:
                text: "FACTURA"
                font_size: dp(40)
                bold: True
                halign: "center"
                size_hint_y: None
                height: dp(60)
                color: 0, 0, 0, 1

            # ==================================================
            # DATOS FACTURA / CLIENTE
            # ==================================================
            GridLayout:
                cols: 2
                size_hint_y: None
                height: dp(150)
                spacing: dp(20)

                # ----- FACTURA -----
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(5)

                    Label:
                        text: "Factura N°: " + root.factura_id
                        font_size: dp(18)
                        bold: True
                        color: 0,0,0,1

                    Label:
                        text: "Fecha: " + root.fecha
                        font_size: dp(16)
                        color: 0.2,0.2,0.2,1

                    Label:
                        text: "Total: $" + str(root.total)
                        font_size: dp(20)
                        bold: True
                        color: 0,0.5,0,1

                # ----- CLIENTE -----
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(5)

                    Label:
                        text: "Cliente"
                        bold: True
                        font_size: dp(18)
                        color: 0,0,0,1

                    Label:
                        text: "Nombre: " + root.cli_nombre
                        font_size: dp(16)
                        color: 0.2,0.2,0.2,1

                    Label:
                        text: "Tel: " + root.cli_tel
                        font_size: dp(16)
                        color: 0.2,0.2,0.2,1

                    Label:
                        text: "Email: " + root.cli_email
                        font_size: dp(16)
                        color: 0.2,0.2,0.2,1

                    Label:
                        text: "CUIT / CI: " + root.cli_cuit
                        font_size: dp(16)
                        color: 0.2,0.2,0.2,1

            # ==================================================
            # TABLA DE PRODUCTOS
            # ==================================================
            Label:
                text: ""
                height: dp(10)
                size_hint_y: None

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)

                # ----- Encabezados -----
                BoxLayout:
                    size_hint_y: None
                    height: dp(40)
                    padding: dp(5)
                    spacing: dp(10)

                    Label:
                        text: "Producto"
                        bold: True
                        font_size: dp(18)
                        halign: "left"
                        valign: "middle"
                        text_size: self.size

                    Label:
                        text: "Cant."
                        bold: True
                        font_size: dp(18)
                        halign: "center"
                        valign: "middle"
                        text_size: self.size
                        size_hint_x: 0.15

                    Label:
                        text: "Precio"
                        bold: True
                        font_size: dp(18)
                        halign: "center"
                        valign: "middle"
                        text_size: self.size
                        size_hint_x: 0.2

                    Label:
                        text: "Subtotal"
                        bold: True
                        font_size: dp(18)
                        halign: "right"
                        valign: "middle"
                        text_size: self.size
                        size_hint_x: 0.25

                # ----- FILAS DINÁMICAS (CORREGIDO) -----
                GridLayout:
                    id: tabla_items
                    cols: 4
                    size_hint_y: None
                    height: self.minimum_height
                    row_default_height: dp(35)
                    row_force_default: True
                    spacing: dp(10)



    # ==================================================
    # BOTONES PDF & VOLVER
    # ==================================================
    BoxLayout:
        size_hint_y: None
        height: dp(60)
        spacing: dp(20)

        Button:
            text: "Generar PDF"
            background_color: 0, 0.2, 0.4, 1
            color: 1,1,1,1
            on_release: root.generar_pdf()

        Button:
            text: "Volver"
            background_color: 0.1, 0.1, 0.1, 1
            color: 1,1,1,1
            on_release: root.volver()
